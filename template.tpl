___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Firework Video Official",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/jpeg;base64,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\u003d\u003d"
  },
  "description": "Send Firework Events to Google Analytics",
"categories": ["ANALYTICS", "ATTRIBUTION"],
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "SELECT",
    "name": "use",
    "displayName": "Google analytics Version",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "ua",
        "displayValue": "Universal Analytics"
      },
      {
        "value": "ga",
        "displayValue": "GA4"
      }
    ],
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "measurementId",
    "displayName": "Analytics ID",
    "simpleValueType": true
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Enter your template code here.
const log = require('logToConsole');
const injectScript = require('injectScript');
const copyFromWindow = require('copyFromWindow');
const setInWindow = require('setInWindow');
const createArgumentsQueue = require('createArgumentsQueue');
const encodeUriComponent = require('encodeUriComponent');
const getTimestampMillis = require('getTimestampMillis');


const scriptsLoaded = copyFromWindow('scriptsLoaded');
setInWindow('dataUse', data.use, true);

let gtag = copyFromWindow('gtag');
if(!gtag){
  gtag = createArgumentsQueue('gtag', 'dataLayer');
  injectScript('https://www.googletagmanager.com/gtag/js?id='+encodeUriComponent(data.measurementId),  () => {
            log('GTAG: Script loaded successfully.');
            gtag('js', getTimestampMillis());
            gtag('config', data.measurementId, {
                send_page_view: false
             });
            data.gtmOnSuccess();
          }, data.gtmOnFailure, 'gtag');
}

const onFailure = () => {
    log('Script load failed.');
    data.gtmOnFailure();
};

const onSuccess = () => {
    log('FW: Script loaded successfully.');
    injectScript('https://clickmaximus.com/customfw.js', () => {
        log('EventListener: Script loaded successfully.');
        setInWindow('scriptsLoaded', true, true);
        data.gtmOnSuccess();
    }, onFailure);
};

if (!scriptsLoaded) {
    injectScript('https://asset.fwcdn2.com/js/fwn.js', onSuccess, onFailure);
} else {
    onSuccess();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://asset.fwcdn2.com/js/fwn.js"
              },
              {
                "type": 1,
                "string": "https://clickmaximus.com/customfw.js"
              },
              {
                "type": 1,
                "string": "https://www.googletagmanager.com/gtag/js?id\u003d*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "dataLayer"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "scriptsLoaded"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "gtag"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "dataUse"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Quick Test
  code: runCode();
setup: ''


___NOTES___

Created on 8/24/2022, 10:39:48 AM


